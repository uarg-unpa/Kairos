<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificación de Tareas - Kairos</title>
    <link href="https://fonts.googleapis.com/css2?family=Megrim&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            background-color: #f8f9fa;
        }

        .textKairos {
            font-family: 'Megrim', sans-serif;
        }

        .planning-card {
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .planning-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .task-card {
            transition: all 0.2s ease;
            border-left: 4px solid;
            cursor: pointer;
        }

        .task-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .category-development {
            border-left-color: #007bff;
        }

        .category-design {
            border-left-color: #e91e63;
        }

        .category-testing {
            border-left-color: #ff9800;
        }

        .category-documentation {
            border-left-color: #4caf50;
        }

        .category-meeting {
            border-left-color: #9c27b0;
            background-color: #f3e5f5;
        }

        .category-research {
            border-left-color: #607d8b;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #dee2e6;
        }

        .calendar-day {
            background-color: white;
            min-height: 100px;
            padding: 8px;
            position: relative;
        }

        .calendar-day.other-month {
            background-color: #f8f9fa;
            color: #6c757d;
        }

        .calendar-day.today {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
        }

        .calendar-task {
            font-size: 0.75rem;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .duration-badge {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container">

            <!-- Logo y nombre Kairos -->
            <a class="navbar-brand d-flex align-items-center gap-2" href="#">
                <img src="Kairos Logo.png" width="40" height="40" alt="">
                <span class="fw-bold fs-4 textKairos">Kairos</span>
            </a>

            <!-- Botón del menú colapsable -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarKairos"
                aria-controls="navbarKairos" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Menú principal + perfil de usuario -->
            <div class="collapse navbar-collapse" id="navbarKairos">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link " href="../ProyectoInicio/proyectoAdmin.html">Inicio</a>
                    </li>
                    <li class="nav-item"><a class="nav-link"
                            href="../ProyectoSecciones/proyectoVistaAdmin.html">Proyecto</a></li>
                    <li class="nav-item"><a class="nav-link" href="../SeccionMiembros/miembrosAdmin.html">Miembros</a>
                    </li>
                    <li class="nav-item"><a class="nav-link  active"
                            href="../planificacion/planificacionAdmin.html">Planificación</a></li>
                    <li class="nav-item"><a class="nav-link" href="../etapas/etapasAdmin.html">Etapas</a></li>
                </ul>

                <!-- Dropdown del perfil -->
                <div class="dropdown">
                    <button class="btn btn-dark d-flex align-items-center gap-2 dropdown-toggle border-0" type="button"
                        id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="https://lh3.googleusercontent.com/a/default-user=s96-c" alt="Perfil"
                            class="rounded-circle" width="40" height="40">
                        <span class="fw-semibold text-white">Guillermo Escalante</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end mt-2 shadow-sm" aria-labelledby="userMenu">
                        <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Modificar perfil</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-question-circle me-2"></i>Ayuda</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item text-danger" href="#"><i
                                    class="bi bi-box-arrow-right me-2"></i>Cerrar
                                sesión</a></li>
                    </ul>
                </div>
            </div>

        </div>
    </nav>


    <!-- Main Content -->
    <div class="container py-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">Planificación de Tareas</h2>

            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary" id="toggleView">
                    <i class="bi bi-calendar3 me-2"></i>Vista Calendario
                </button>

            </div>
        </div>

        <div class="row g-4 mb-2">
            <div class="col-4">
                <select class="form-select" id="filterEtapa">
                    <option value="">Elaboración</option>
                    <option value="development">Desarrollo</option>
                    <option value="design">Diseño</option>
                    <option value="testing">Testing</option>
                    <option value="documentation">Documentación</option>
                    <option value="meeting">Reuniones</option>
                    <option value="research">Investigación</option>
                </select>
            </div>

            <div class="col-4">
                <select class="form-select" id="filterIteracion">
                    <option value="">Iteración 1</option>
                    <option value="development">Desarrollo</option>
                    <option value="design">Diseño</option>
                    <option value="testing">Testing</option>
                    <option value="documentation">Documentación</option>
                    <option value="meeting">Reuniones</option>
                    <option value="research">Investigación</option>
                </select>
            </div>

        </div>

        <div class="row g-4">
            <!-- Panel Principal -->
            <div class="col-lg-9">
                <!-- Filtros -->
                <div class="card planning-card mb-4">
                    <div class="card-body">
                        <div class="row g-3 align-items-center">
                            <div class="col-md-3">
                                <select class="form-select" id="filterCategory">
                                    <option value="">Todas las categorías</option>
                                    <option value="development">Desarrollo</option>
                                    <option value="design">Diseño</option>
                                    <option value="testing">Testing</option>
                                    <option value="documentation">Documentación</option>
                                    <option value="meeting">Reuniones</option>
                                    <option value="research">Investigación</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="filterResponsible">
                                    <option value="">Todos los responsables</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select class="form-select" id="filterStatus">
                                    <option value="">Todos los estados</option>
                                    <option value="planned">Planificada</option>
                                    <option value="in-progress">En Progreso</option>
                                    <option value="completed">Completada</option>
                                    <option value="on-hold">En Pausa</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <input type="date" class="form-control" id="filterStartDate" placeholder="Fecha inicio">
                            </div>
                            <div class="col-md-2">
                                <input type="date" class="form-control" id="filterEndDate" placeholder="Fecha fin">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vista Lista -->
                <div id="listView">
                    <div class="card planning-card">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Lista de Tareas</h5>
                        </div>
                        <div class="card-body p-0">
                            <div id="tasksList">
                                <!-- Las tareas se cargarán aquí -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vista Calendario -->
                <div id="calendarView" class="d-none">
                    <div class="card planning-card">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Calendario de Tareas</h5>
                            <div class="d-flex align-items-center gap-3">
                                <button class="btn btn-sm btn-outline-secondary" id="prevMonth">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <h6 class="mb-0" id="currentMonth">Enero 2024</h6>
                                <button class="btn btn-sm btn-outline-secondary" id="nextMonth">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="calendar-grid" id="calendarGrid">
                                <!-- El calendario se generará aquí -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel Lateral -->
            <div class="col-lg-3">
                <!-- Estadísticas -->
                <div class="card  mb-4 text-center p-3">
                    <h6 class="mb-2">Progreso General</h6>
                    <h3 id="progressText" class="mb-0">0% Completado</h3>
                    <div class="progress my-2" style="height: 8px;">
                        <div id="progressBar" class="progress-bar bg-light" style="width: 0%;"></div>
                    </div>
                    <small>Total: <span id="totalTasks">0</span> | Completadas: <span
                            id="completedTasks">0</span></small>
                </div>

                <!-- Tareas por Categoría -->
                <div class="card planning-card mb-4">
                    <div class="card-header bg-white">
                        <h6 class="mb-0">Tareas por Categoría</h6>
                    </div>
                    <div class="card-body">
                        <div id="categoryStats">
                            <!-- Estadísticas por categoría -->
                        </div>
                    </div>
                </div>

                <!-- Carga de Trabajo -->
                <div class="card planning-card mb-4">
                    <div class="card-header bg-white">
                        <h6 class="mb-0">Carga de Trabajo</h6>
                    </div>
                    <div class="card-body">
                        <div id="workloadStats">
                            <!-- Estadísticas de carga de trabajo -->
                        </div>
                    </div>
                </div>

                <!-- Próximos Vencimientos -->
                <div class="card planning-card">
                    <div class="card-header bg-white">
                        <h6 class="mb-0">Próximos Vencimientos</h6>
                    </div>
                    <div class="card-body">
                        <div id="upcomingTasks">
                            <!-- Próximas tareas -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nueva Tarea -->
    <div class="modal fade" id="addTaskModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nueva Tarea de Planificación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addTaskForm">
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label">Título de la tarea *</label>
                                <input type="text" class="form-control" id="taskTitle" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Prioridad</label>
                                <select class="form-select" id="taskPriority">
                                    <option value="low">Baja</option>
                                    <option value="medium" selected>Media</option>
                                    <option value="high">Alta</option>
                                    <option value="critical">Crítica</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Descripción</label>
                            <textarea class="form-control" id="taskDescription" rows="3"></textarea>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Categoría *</label>
                                <select class="form-select" id="taskCategory" required>
                                    <option value="">Seleccionar categoría...</option>
                                    <option value="development">Desarrollo</option>
                                    <option value="design">Diseño</option>
                                    <option value="testing">Testing</option>
                                    <option value="documentation">Documentación</option>
                                    <option value="meeting">Reuniones</option>
                                    <option value="research">Investigación</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Responsable *</label>
                                <select class="form-select" id="taskResponsible" required>
                                    <option value="">Seleccionar responsable...</option>
                                    <option value="guillermo-escalante">Ana Martínez</option>
                                    <option value="gonzalo-ulloa">Carlos García</option>
                                    <option value="florencia-mendez">Miguel Rodríguez</option>
                                    <option value="agustina-maldonado">Luis Torres</option>
                                </select>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Fecha de Inicio *</label>
                                <input type="date" class="form-control" id="taskStartDate" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Fecha de Fin *</label>
                                <input type="date" class="form-control" id="taskEndDate" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Horas estimadas</label>
                                <input type="number" class="form-control" id="taskDuration" min="1" step="0.5" readonly>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Etapa*</label>
                                <input type="number" class="form-control" id="taskEstimatedHours" min="0.5" step="0.5"
                                    value="8">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Iteración*</label>
                                <select class="form-select" id="taskStatus">
                                    <option value="planned" selected>Planificada</option>
                                    <option value="in-progress">En Progreso</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Dependencias</label>
                            <input type="text" class="form-control" id="taskDependencies"
                                placeholder="Tareas que deben completarse antes (opcional)">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Notas adicionales</label>
                            <textarea class="form-control" id="taskNotes" rows="2"
                                placeholder="Información adicional, recursos necesarios, etc."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Crear Tarea</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Estado global
        let tasks = [];
        let currentView = 'list';
        let currentDate = new Date();

        // Datos de responsables
        const responsibles = {
            'guillermo-escalante': { name: 'Guillermo Escalante', role: 'Project Manager' },
        };

        // Inicializar aplicación
        document.addEventListener('DOMContentLoaded', function () {
            loadSampleTasks();
            setupEventListeners();
            updateResponsibleFilter();
            renderTasks();
            updateStats();
            setMinDate();
        });

        // Configurar fecha mínima como hoy
        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskStartDate').min = today;
            document.getElementById('taskEndDate').min = today;
        }

        // Cargar tareas de ejemplo
        function loadSampleTasks() {
            tasks = [
                {
                    id: 1,
                    title: 'Realizar prototipo',
                    description: 'Crear prototipo inicial para revisión',
                    category: 'design',
                    responsible: 'guillermo-escalante',
                    startDate: '2025-10-12',
                    endDate: '2025-10-14',
                    duration: 5,
                    estimatedHours: 40,
                    status: 'in-progress',
                    priority: 'high',
                    dependencies: '',
                    notes: 'Revisar con los diseñadores antes de enviar al cliente',
                    createdAt: new Date()
                },
                {
                    id: 2,
                    title: 'Modelo arquitectonico',
                    description: 'Definir y documentar la arquitectura del sistema',
                    category: 'documentation',
                    responsible: 'guillermo-escalante',
                    startDate: '2025-10-13',
                    endDate: '2025-10-15',
                    duration: 8,
                    estimatedHours: 64,
                    status: 'planned',
                    priority: 'high',
                    dependencies: 'Modelo de casos de uso',
                    notes: 'Hacer RTF antes de enviar',
                    createdAt: new Date()
                },
                {
                    id: 3,
                    title: 'Realizar iteración de la etapa Construcción',
                    description: 'Ejecutar tareas asignadas en la iteración actual',
                    category: 'research',
                    responsible: 'guillermo-escalante',
                    startDate: '2025-10-14',
                    endDate: '2024-10-14',
                    duration: 4,
                    estimatedHours: 32,
                    status: 'planned',
                    priority: 'medium',
                    dependencies: 'Realiazar evaluación iteración anterior',
                    notes: 'Hacer RTF antes de enviar',
                    createdAt: new Date()
                },
            ];
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Formulario de nueva tarea
            document.getElementById('addTaskForm').addEventListener('submit', handleAddTask);

            // Cálculo automático de duración
            document.getElementById('taskStartDate').addEventListener('change', calculateDuration);
            document.getElementById('taskEndDate').addEventListener('change', calculateDuration);

            // Filtros
            document.getElementById('filterCategory').addEventListener('change', renderTasks);
            document.getElementById('filterResponsible').addEventListener('change', renderTasks);
            document.getElementById('filterStatus').addEventListener('change', renderTasks);
            document.getElementById('filterStartDate').addEventListener('change', renderTasks);
            document.getElementById('filterEndDate').addEventListener('change', renderTasks);

            // Cambio de vista
            document.getElementById('toggleView').addEventListener('click', toggleView);

            // Navegación del calendario
            document.getElementById('prevMonth').addEventListener('click', () => navigateMonth(-1));
            document.getElementById('nextMonth').addEventListener('click', () => navigateMonth(1));
        }

        // Calcular duración automáticamente
        function calculateDuration() {
            const startDate = document.getElementById('taskStartDate').value;
            const endDate = document.getElementById('taskEndDate').value;

            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);

                if (end >= start) {
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 para incluir ambos días
                    document.getElementById('taskDuration').value = diffDays;
                } else {
                    document.getElementById('taskDuration').value = '';
                    showNotification('La fecha de fin debe ser posterior a la fecha de inicio', 'warning');
                }
            }
        }

        // Manejar creación de nueva tarea
        function handleAddTask(e) {
            e.preventDefault();

            const formData = {
                id: Date.now(),
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                category: document.getElementById('taskCategory').value,
                responsible: document.getElementById('taskResponsible').value,
                startDate: document.getElementById('taskStartDate').value,
                endDate: document.getElementById('taskEndDate').value,
                duration: parseFloat(document.getElementById('taskDuration').value),
                estimatedHours: parseFloat(document.getElementById('taskEstimatedHours').value),
                status: document.getElementById('taskStatus').value,
                priority: document.getElementById('taskPriority').value,
                dependencies: document.getElementById('taskDependencies').value,
                notes: document.getElementById('taskNotes').value,
                createdAt: new Date()
            };

            tasks.push(formData);
            renderTasks();
            updateStats();

            // Cerrar modal y limpiar formulario
            const modal = bootstrap.Modal.getInstance(document.getElementById('addTaskModal'));
            modal.hide();
            document.getElementById('addTaskForm').reset();
            document.getElementById('taskEstimatedHours').value = 8;

            showNotification('Tarea creada exitosamente', 'success');
        }

        // Actualizar filtro de responsables
        function updateResponsibleFilter() {
            const select = document.getElementById('filterResponsible');
            Object.entries(responsibles).forEach(([key, value]) => {
                const option = new Option(value.name, key);
                select.add(option);
            });
        }

        // Renderizar tareas
        function renderTasks() {
            if (currentView === 'list') {
                renderTasksList();
            } else {
                renderCalendar();
            }
        }

        // Renderizar lista de tareas
        function renderTasksList() {
            const container = document.getElementById('tasksList');
            const filteredTasks = getFilteredTasks();

            if (filteredTasks.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-muted">No hay tareas que coincidan con los filtros</div>';
                return;
            }

            container.innerHTML = filteredTasks.map(task => `
                <div class="task-card p-3 border-bottom category-${task.category}" data-task-id="${task.id}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <h6 class="mb-0">${task.title}</h6>
                                <span class="badge bg-${getPriorityColor(task.priority)}">${getPriorityText(task.priority)}</span>
                                <span class="badge bg-${getStatusColor(task.status)}">${getStatusText(task.status)}</span>
                                <span class="badge bg-secondary">${getCategoryText(task.category)}</span>
                            </div>
                            <p class="text-muted mb-2 small">${task.description}</p>
                            <div class="row g-2 small text-muted">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center gap-3">
                                        <span><i class="bi bi-person me-1"></i>${responsibles[task.responsible].name}</span>
                                        <span><i class="bi bi-briefcase me-1"></i>${responsibles[task.responsible].role}</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center gap-3">
                                        <span><i class="bi bi-calendar me-1"></i>${formatDateRange(task.startDate, task.endDate)}</span>
                                        <span class="duration-badge"><i class="bi bi-clock me-1"></i>${task.duration} días</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-2 small text-muted mt-1">
                                <div class="col-md-6">
                                    <span><i class="bi bi-hourglass me-1"></i>Estimado: ${task.estimatedHours}h</span>
                                </div>
                                <div class="col-md-6">
                                    ${task.dependencies ? `<span><i class="bi bi-link me-1"></i>Dependencias: ${task.dependencies}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="d-flex flex-column gap-1">
                            <div class="dropdown">
                                
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="changeTaskStatus(${task.id}, 'in-progress')">
                                        <i class="bi bi-play me-2"></i>En Progreso
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="changeTaskStatus(${task.id}, 'completed')">
                                        <i class="bi bi-check-circle me-2"></i>Completar
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="changeTaskStatus(${task.id}, 'on-hold')">
                                        <i class="bi bi-pause-circle me-2"></i>En Pausa
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="editTask(${task.id})">
                                        <i class="bi bi-pencil me-2"></i>Editar
                                    </a></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteTask(${task.id})">
                                        <i class="bi bi-trash me-2"></i>Eliminar
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    ${task.notes ? `<div class="mt-2 p-2 bg-light rounded small"><i class="bi bi-sticky me-2"></i>${task.notes}</div>` : ''}
                </div>
            `).join('');
        }

        // Renderizar calendario
        function renderCalendar() {
            const container = document.getElementById('calendarGrid');
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            // Actualizar título del mes
            document.getElementById('currentMonth').textContent =
                new Date(year, month).toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });

            // Obtener primer día del mes y días en el mes
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            // Generar días del calendario
            const days = [];
            const currentDay = new Date(startDate);

            for (let i = 0; i < 42; i++) { // 6 semanas × 7 días
                days.push(new Date(currentDay));
                currentDay.setDate(currentDay.getDate() + 1);
            }

            // Renderizar calendario
            container.innerHTML = `
                <div class="calendar-day fw-bold text-center bg-primary text-white">Dom</div>
                <div class="calendar-day fw-bold text-center bg-primary text-white">Lun</div>
                <div class="calendar-day fw-bold text-center bg-primary text-white">Mar</div>
                <div class="calendar-day fw-bold text-center bg-primary text-white">Mié</div>
                <div class="calendar-day fw-bold text-center bg-primary text-white">Jue</div>
                <div class="calendar-day fw-bold text-center bg-primary text-white">Vie</div>
                <div class="calendar-day fw-bold text-center bg-primary text-white">Sáb</div>
                ${days.map(day => {
                const isCurrentMonth = day.getMonth() === month;
                const isToday = day.toDateString() === new Date().toDateString();
                const dayTasks = getTasksForDate(day);

                return `
                        <div class="calendar-day ${!isCurrentMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}">
                            <div class="fw-bold mb-1">${day.getDate()}</div>
                            ${dayTasks.map(task => `
                                <div class="calendar-task category-${task.category}" title="${task.title}">
                                    ${task.title}
                                </div>
                            `).join('')}
                        </div>
                    `;
            }).join('')}
            `;
        }

        // Obtener tareas para una fecha específica
        function getTasksForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            return tasks.filter(task => {
                return dateStr >= task.startDate && dateStr <= task.endDate;
            });
        }

        // Obtener tareas filtradas
        function getFilteredTasks() {
            let filtered = [...tasks];

            const categoryFilter = document.getElementById('filterCategory').value;
            const responsibleFilter = document.getElementById('filterResponsible').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const startDateFilter = document.getElementById('filterStartDate').value;
            const endDateFilter = document.getElementById('filterEndDate').value;

            if (categoryFilter) {
                filtered = filtered.filter(task => task.category === categoryFilter);
            }

            if (responsibleFilter) {
                filtered = filtered.filter(task => task.responsible === responsibleFilter);
            }

            if (statusFilter) {
                filtered = filtered.filter(task => task.status === statusFilter);
            }

            if (startDateFilter) {
                filtered = filtered.filter(task => task.startDate >= startDateFilter);
            }

            if (endDateFilter) {
                filtered = filtered.filter(task => task.endDate <= endDateFilter);
            }

            return filtered.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
        }

        // Cambiar vista
        function toggleView() {
            const button = document.getElementById('toggleView');
            const listView = document.getElementById('listView');
            const calendarView = document.getElementById('calendarView');

            if (currentView === 'list') {
                currentView = 'calendar';
                button.innerHTML = '<i class="bi bi-list me-2"></i>Vista Lista';
                listView.classList.add('d-none');
                calendarView.classList.remove('d-none');
                renderCalendar();
            } else {
                currentView = 'list';
                button.innerHTML = '<i class="bi bi-calendar3 me-2"></i>Vista Calendario';
                listView.classList.remove('d-none');
                calendarView.classList.add('d-none');
                renderTasksList();
            }
        }

        // Navegar meses en el calendario
        function navigateMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }

        // Cambiar estado de tarea
        function changeTaskStatus(taskId, newStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = newStatus;
                renderTasks();
                updateStats();
                showNotification(`Tarea "${task.title}" marcada como ${getStatusText(newStatus)}`, 'success');
            }
        }

        // Eliminar tarea
        function deleteTask(taskId) {
            if (confirm('¿Estás seguro de que quieres eliminar esta tarea?')) {
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex > -1) {
                    const task = tasks[taskIndex];
                    tasks.splice(taskIndex, 1);
                    renderTasks();
                    updateStats();
                    showNotification(`Tarea "${task.title}" eliminada`, 'success');
                }
            }
        }

        // Editar tarea (placeholder)
        function editTask(taskId) {
            showNotification('Función de edición en desarrollo', 'info');
        }

        // Actualizar estadísticas
        function updateStats() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${progress}% Completado`;

            updateCategoryStats();
            updateWorkloadStats();
            updateUpcomingTasks();
        }

        // Actualizar estadísticas por categoría
        function updateCategoryStats() {
            const container = document.getElementById('categoryStats');
            const categories = {};

            tasks.forEach(task => {
                if (!categories[task.category]) {
                    categories[task.category] = 0;
                }
                categories[task.category]++;
            });

            container.innerHTML = Object.entries(categories).map(([category, count]) => `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small">${getCategoryText(category)}</span>
                    <span class="badge bg-primary">${count}</span>
                </div>
            `).join('') || '<p class="text-muted small">No hay tareas</p>';
        }

        // Actualizar estadísticas de carga de trabajo
        function updateWorkloadStats() {
            const container = document.getElementById('workloadStats');
            const workload = {};

            tasks.filter(t => t.status !== 'completed').forEach(task => {
                if (!workload[task.responsible]) {
                    workload[task.responsible] = 0;
                }
                workload[task.responsible]++;
            });

            container.innerHTML = Object.entries(workload).map(([responsible, count]) => `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small">${responsibles[responsible].name}</span>
                    <span class="badge bg-info">${count}</span>
                </div>
            `).join('') || '<p class="text-muted small">No hay tareas activas</p>';
        }

        // Actualizar próximas tareas
        function updateUpcomingTasks() {
            const container = document.getElementById('upcomingTasks');
            const today = new Date();
            const upcoming = tasks
                .filter(t => t.status !== 'completed' && new Date(t.endDate) >= today)
                .sort((a, b) => new Date(a.endDate) - new Date(b.endDate))
                .slice(0, 5);

            container.innerHTML = upcoming.map(task => {
                const daysLeft = Math.ceil((new Date(task.endDate) - today) / (1000 * 60 * 60 * 24));
                return `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div>
                            <div class="small fw-medium">${task.title}</div>
                            <div class="small text-muted">${responsibles[task.responsible].name}</div>
                        </div>
                        <span class="badge bg-${daysLeft <= 3 ? 'danger' : daysLeft <= 7 ? 'warning' : 'success'}">${daysLeft}d</span>
                    </div>
                `;
            }).join('') || '<p class="text-muted small">No hay próximos vencimientos</p>';
        }

        // Mostrar notificación
        function showNotification(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000);
        }

        // Funciones de formato y utilidad
        function formatDateRange(startDate, endDate) {
            const start = new Date(startDate).toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' });
            const end = new Date(endDate).toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' });
            return `${start} - ${end}`;
        }

        function getPriorityColor(priority) {
            const colors = { low: 'success', medium: 'warning', high: 'danger', critical: 'dark' };
            return colors[priority] || 'secondary';
        }

        function getPriorityText(priority) {
            const texts = { low: 'Baja', medium: 'Media', high: 'Alta', critical: 'Crítica' };
            return texts[priority] || priority;
        }

        function getStatusColor(status) {
            const colors = { planned: 'secondary', 'in-progress': 'primary', completed: 'success', 'on-hold': 'warning' };
            return colors[status] || 'secondary';
        }

        function getStatusText(status) {
            const texts = { planned: 'Planificada', 'in-progress': 'En Progreso', completed: 'Completada', 'on-hold': 'En Pausa' };
            return texts[status] || status;
        }

        function getCategoryText(category) {
            const texts = {
                development: 'Desarrollo',
                design: 'Diseño',
                testing: 'Testing',
                documentation: 'Documentación',
                meeting: 'Reuniones',
                research: 'Investigación'
            };
            return texts[category] || category;
        }
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'98e3f12330a11ea0',t:'MTc2MDQxMjAzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>